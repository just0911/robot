# 05ï½œK8s æç®€å®æˆ˜ï¼šç¤ºä¾‹åº”ç”¨ä»‹ç»
ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹ç‚œã€‚

ä¸Šä¸€ç« ï¼Œæˆ‘ä»¬ä»¥ä¸€ä¸ª Python åº”ç”¨ä¸ºä¾‹ï¼Œå­¦ä¹ äº†å°†åº”ç”¨è¿ç§»åˆ°äº‘åŸç”Ÿæ¶æ„ä¸‹çš„å®Œæ•´è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä»å®¹å™¨åŒ–ã€éƒ¨ç½²åˆ° K8sã€å¼¹æ€§ä¼¸ç¼©æœ€ååˆ° GitOps çš„å…¨è¿‡ç¨‹ã€‚åœ¨å®æˆ˜çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ²¡æœ‰å¤ªå¤šåœ°ä»‹ç»æ¦‚å¿µï¼Œè€Œæ˜¯è®©ä½ ç›´æ¥ä¸Šæ‰‹æ„Ÿå— K8s å’Œ GitOps çš„å¼ºå¤§ä¹‹å¤„ã€‚

è¿™ä¸€ç« ï¼Œæˆ‘ä¼šè®¾è®¡ä¸€ä¸ªæ›´åŠ æ¥è¿‘çœŸå®ä¸šåŠ¡çš„ç¤ºä¾‹åº”ç”¨ã€‚è¿™ä¸ªåº”ç”¨ä¼šæ¶µç›–ä½ åœ¨å·¥ä½œä¸­å¸¸ç”¨çš„ K8s å¯¹è±¡ï¼ŒåŒ…æ‹¬ Deploymentã€Serviceã€Ingressã€HPAã€Namespaceã€ConfigMap ç­‰ã€‚åœ¨å°†è¿™ä¸ªåº”ç”¨éƒ¨ç½²åˆ° K8s çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šé€æ¸æ·±å…¥åˆ°æ¯ä¸ª K8s å¯¹è±¡ä¸­ã€‚

è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹è¿™ä¸ªç¤ºä¾‹åº”ç”¨ã€‚

åœ¨å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼Œä½ éœ€è¦åšå¥½ä»¥ä¸‹å‡†å¤‡ï¼š

- å‡†å¤‡ä¸€å°ç”µè„‘ï¼ˆé¦–é€‰ Linux æˆ– macOSï¼ŒWindows ä¹Ÿé€‚ç”¨ï¼Œæ³¨æ„æ“ä½œå·®å¼‚ï¼‰ï¼›
- [å®‰è£… Docker](https://docs.docker.com/engine/install/)ï¼›
- [å®‰è£… Kubectl](https://kubernetes.io/docs/tasks/tools/)ï¼›
- [å®‰è£… Kind](https://kind.sigs.k8s.io/docs/user/quick-start/#installation)ã€‚

## æ¶æ„ä»‹ç»

### åº”ç”¨æ¶æ„

æˆ‘è®¾è®¡çš„è¿™ä¸ªç¤ºä¾‹åº”ç”¨æ˜¯ä¸€å¥—å¾®æœåŠ¡æ¶æ„çš„åº”ç”¨ï¼Œä½ å¯ä»¥åœ¨ GitHub ä¸Šè·å– [æºç ](https://github.com/lyzhang1999/kubernetes-example)ï¼Œæºç ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```powershell
$ ls
backendÂ  deployÂ  Â frontend

```

åœ¨è¿™é‡Œï¼Œbackend ç›®å½•ä¸ºåç«¯æºç ï¼Œfrontend ç›®å½•ä¸ºå‰ç«¯æºç ï¼Œdeploy ç›®å½•æ˜¯åº”ç”¨çš„ K8s Manifestï¼Œå‰åç«¯éƒ½å·²ç»åŒ…å«æ„å»ºé•œåƒæ‰€éœ€çš„ Dockerfileã€‚

ç¤ºä¾‹åº”ç”¨ç”±ä¸‰ä¸ªæœåŠ¡ç»„æˆï¼š

1. å‰ç«¯ï¼›
2. åç«¯ï¼›
3. æ•°æ®åº“ã€‚

å…¶ä¸­ï¼Œå‰ç«¯é‡‡ç”¨ React ç¼–å†™ï¼Œå®ƒä¹Ÿæ˜¯åº”ç”¨å¯¹å¤–æä¾›æœåŠ¡çš„å…¥å£ï¼›åç«¯ç”± Python ç¼–å†™ï¼›æ•°æ®åº“é‡‡ç”¨æµè¡Œçš„ Postgresã€‚åº”ç”¨æ•´ä½“æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![å›¾ç‰‡](images/614570/e47ayy03e7a3a6429c6c5b404133ede0.jpg)

å‰ç«¯å®ç°äº†ä¸‰ä¸ªåŠŸèƒ½ï¼Œåˆ†åˆ«æ˜¯å­˜å‚¨è¾“å…¥çš„å†…å®¹ï¼Œåˆ—å‡ºè¾“å…¥å†…å®¹è®°å½•ä»¥åŠåˆ é™¤æ‰€æœ‰çš„è®°å½•ã€‚è¿™ä¸‰ä¸ªåŠŸèƒ½åˆ†åˆ«å¯¹åº”äº†åç«¯çš„ä¸‰ä¸ªæ¥å£ï¼Œä¹Ÿå°±æ˜¯ /add, /fetch å’Œ /deleteï¼Œæœ€åæ•°æ®ä¼šè¢«å­˜å‚¨åœ¨ Postgres æ•°æ®åº“ä¸­ã€‚

ç¤ºä¾‹åº”ç”¨çš„å‰ç«¯ç•Œé¢å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![å›¾ç‰‡](images/614570/4d24857b5b97a1c8e7629198c8f379af.png)

### K8s éƒ¨ç½²æ¶æ„

ä¸ºäº†æ–¹ä¾¿ä½ æŠŠç¤ºä¾‹åº”ç”¨ç›´æ¥éƒ¨ç½²åˆ° K8s é›†ç¾¤å†…ï¼Œæˆ‘å·²ç»å†™å¥½äº† K8s Manifest æ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨ [GitHub](https://github.com/lyzhang1999/kubernetes-example/tree/main/deploy) æ‰¾åˆ°è¿™äº›æ¸…å•æ–‡ä»¶ã€‚åº”ç”¨çš„ K8s éƒ¨ç½²æ¶æ„å›¾å¦‚ä¸‹ï¼š

![å›¾ç‰‡](images/614570/f1e65380bb2342676024341b034f0e56.jpg)

åœ¨è¿™å¼ æ¶æ„å›¾ä¸­ï¼ŒIngress æ˜¯åº”ç”¨çš„å…¥å£ï¼ŒIngress ä¼šæ ¹æ®è¯·æ±‚è·¯å¾„å°†æµé‡åˆ†æµè‡³å‰åç«¯çš„ Service ä¸­ï¼Œç„¶å Service å°†è¯·æ±‚è½¬å‘ç»™å‰åç«¯ Pod è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œåç«¯çš„å·¥ä½œè´Ÿè½½ Deployment é…ç½®äº† HPA è‡ªåŠ¨æ¨ªå‘æ‰©å®¹ã€‚åŒæ—¶ï¼ŒPostgres ä¹Ÿæ˜¯ä»¥ Deployment çš„æ–¹å¼éƒ¨ç½²åˆ°é›†ç¾¤å†…çš„ã€‚æœ€åï¼Œæ‰€æœ‰èµ„æºéƒ½éƒ¨ç½²åœ¨ K8s çš„ example å‘½åç©ºé—´ï¼ˆNamespaceï¼‰ä¸‹ã€‚

åœ¨ç†Ÿæ‚‰äº†åº”ç”¨æ¶æ„ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æŠŠå®ƒéƒ¨ç½²åˆ° K8s é›†ç¾¤å†…ã€‚

## éƒ¨ç½²åº”ç”¨

### åˆ›å»ºæ–°çš„ K8s é›†ç¾¤

æˆ‘ä»¬è¿˜æ˜¯ä»¥éƒ¨ç½²åˆ°æœ¬åœ° Kind é›†ç¾¤ä¸ºä¾‹ï¼Œä¸ºäº†é¿å…èµ„æºå†²çªï¼Œéœ€è¦å…ˆæŠŠç¬¬ä¸€ç« å®éªŒè¿‡ç¨‹åˆ›å»ºçš„ Kind é›†ç¾¤åˆ æ‰ã€‚ä½ å¯ä»¥ç”¨ kind delete cluster æ¥åˆ é™¤é›†ç¾¤ï¼š

```powershell
$ kind delete cluster

```

ç„¶åï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ª K8s é›†ç¾¤ï¼Œå°†ä¸‹é¢çš„å†…å®¹ä¿å­˜ä¸º config.yamlï¼š

```yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  kubeadmConfigPatches:
  - |
    kind: InitConfiguration
    nodeRegistration:
      kubeletExtraArgs:
        node-labels: "ingress-ready=true"
  extraPortMappings:
  - containerPort: 80
    hostPort: 80
    protocol: TCP
  - containerPort: 443
    hostPort: 443
    protocol: TCP

```

æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ kind create cluster é‡æ–°åˆ›å»ºé›†ç¾¤ï¼š

```yaml
â¯ kind create cluster --config config.yaml
Creating cluster "kind" ...
 âœ“ Ensuring node image (kindest/node:v1.23.4) ğŸ–¼
 âœ“ Preparing nodes ğŸ“¦
 âœ“ Writing configuration ğŸ“œ
 âœ“ Starting control-plane ğŸ•¹ï¸
 âœ“ Installing CNI ğŸ”Œ
 âœ“ Installing StorageClass ğŸ’¾
Set kubectl context to "kind-kind"
You can now use your cluster with:

kubectl cluster-info --context kind-kind

```

ç”±äºç¤ºä¾‹åº”ç”¨ä½¿ç”¨äº† Ingressï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸º Kind éƒ¨ç½² Ingressï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl apply -f æ¥éƒ¨ç½² Ingress-Nginxï¼š

```powershell
$ kubectl create -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/resource/main/ingress-nginx/ingress-nginx.yaml
namespace/ingress-nginx created
serviceaccount/ingress-nginx created
serviceaccount/ingress-nginx-admission created
......

```

æœ€åï¼Œå†éƒ¨ç½² Metric Serverï¼Œä»¥ä¾¿å¼€å¯ HPA åŠŸèƒ½ï¼š

```powershell
$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/resource/main/metrics/metrics.yaml
serviceaccount/metrics-server created
clusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created
clusterrole.rbac.authorization.k8s.io/system:metrics-server created
......

```

**å‡†å¤‡å¥½æ–°çš„ K8s é›†ç¾¤åï¼Œå°±å¯ä»¥å¼€å§‹éƒ¨ç½²ç¤ºä¾‹åº”ç”¨äº†ã€‚**

### éƒ¨ç½²ç¤ºä¾‹åº”ç”¨

æˆ‘ä»¬æŠŠç¤ºä¾‹åº”ç”¨æ‰€æœ‰çš„èµ„æºéƒ½éƒ¨ç½²åœ¨ä¸€ä¸ªæ–°çš„å‘½åç©ºé—´ä¸‹ï¼Œæ–°çš„å‘½åç©ºé—´å‘½åä¸º exampleã€‚æˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºè¯¥å‘½åç©ºé—´ï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl create namespace æ¥åˆ›å»ºå‘½åç©ºé—´ï¼š

```powershell
$ kubectl create namespace example
namespace/example created

```

ç„¶åï¼Œåˆ›å»º Postgres æ•°æ®åº“ï¼ŒåŒæ ·ä½¿ç”¨ kubectl apply æ¥åˆ›å»ºï¼š

```powershell
$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/database.yaml -n example
configmap/pg-init-script created
deployment.apps/postgres created
service/pg-service created

```

åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œ-n å‚æ•°ä»£è¡¨æŒ‡å®šå‘½åç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ example å‘½åç©ºé—´ï¼Œ **æ³¨æ„ï¼Œåç»­åˆ›å»ºèµ„æºæ—¶éƒ½éœ€è¦æŒ‡å®šè¿™ä¸ªå‘½åç©ºé—´ã€‚**

ç„¶åå†åˆ†åˆ«åˆ›å»ºå‰åç«¯ Deployment å·¥ä½œè´Ÿè½½å’Œ Serviceï¼š

```powershell
$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/frontend.yaml -n example
deployment.apps/frontend created
service/frontend-service created

$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/backend.yaml -n example
deployment.apps/backend created
service/backend-service created

```

æ¥ä¸‹æ¥ï¼Œä¸ºåº”ç”¨åˆ›å»º Ingress å’Œ HPA ç­–ç•¥ï¼š

```powershell
$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/ingress.yaml -n example
ingress.networking.k8s.io/frontend-ingress created

$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/hpa.yaml -n example
horizontalpodautoscaler.autoscaling/backend created

```

å…¶å®ï¼Œé™¤äº†å¯ä»¥æŒ‰ç…§ä¸Šé¢çš„å¼•å¯¼å•ç‹¬åˆ›å»ºç¤ºä¾‹åº”ç”¨çš„æ¯ä¸€ä¸ª K8s å¯¹è±¡ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¦ä¸€ç§æ–¹æ³•ï¼Œé‚£å°±æ˜¯æŠŠè¿™ä¸ª Git ä»“åº“å…‹éš†åˆ°æœ¬åœ°ï¼Œç„¶åä½¿ç”¨ kubectl apply **ä¸€æ¬¡æ€§å°†æ‰€æœ‰ç¤ºä¾‹åº”ç”¨çš„å¯¹è±¡** éƒ¨ç½²åˆ°é›†ç¾¤å†…ï¼š

```yaml
$ git clone https://ghproxy.com/https://github.com/lyzhang1999/kubernetes-example && cd kubernetes-example
Cloning into 'kubernetes-example'...
......
Resolving deltas: 100% (28/28), done.

$ kubectl apply -f deploy -n example
deployment.apps/backend created
service/backend-service created
configmap/pg-init-script created
......

```

è¿™é‡Œçš„ -f å‚æ•°é™¤äº†å¯ä»¥æŒ‡å®šæ–‡ä»¶å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šç›®å½•ï¼Œkubectl å°†ä¼šæ£€æŸ¥ç›®å½•ä¸‹æ‰€æœ‰å¯ç”¨çš„ Manifestï¼Œç„¶åæŠŠå®ƒéƒ¨ç½²åˆ° K8s é›†ç¾¤ã€‚-n å‚æ•°ä»£è¡¨å°†æ‰€æœ‰ Manifest éƒ¨ç½²åˆ° example å‘½åç©ºé—´ã€‚

æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ kubectl wait æ¥æ£€æŸ¥æ‰€æœ‰èµ„æºæ˜¯ä¸æ˜¯å·²ç»å¤„äº Ready çŠ¶æ€äº†ï¼š

```powershell
$ kubectl wait --for=condition=Ready pods --all -n example
pod/backend-9b677898b-n5lsm condition met
pod/frontend-f948bdc85-q6x9f condition met
pod/postgres-7745b57d5d-f4trt condition met

```

**åˆ°è¿™é‡Œï¼Œç¤ºä¾‹åº”ç”¨å°±éƒ¨ç½²å®Œäº†ã€‚**

æ‰“å¼€æµè§ˆå™¨è®¿é—® 127.0.0.1ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ç¤ºä¾‹åº”ç”¨çš„å‰ç«¯ç•Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![å›¾ç‰‡](images/614570/4dae13ff82229226916b7b767d6a5007.png)

ä½ å¯ä»¥å°è¯•åœ¨è¾“å‡ºæ¡†ä¸­è¾“å…¥å†…å®¹ï¼Œå¦‚æœç‚¹å‡» Add æŒ‰é’®ï¼Œä¸‹æ–¹çš„åˆ—è¡¨å†…ä¼šå‡ºç°ä½ è¾“å…¥çš„å†…å®¹ï¼Œç‚¹å‡» Clear æ‰€æœ‰å†…å®¹è¢«æ¸…ç©ºï¼Œè¿™å°±è¯´æ˜åº”ç”¨å·²ç»å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚

## K8s å¯¹è±¡è§£æ

åœ¨è¿™ä¸ªç¤ºä¾‹åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å‘½åç©ºé—´æ¥éƒ¨ç½²æ‰€æœ‰èµ„æºï¼Œè¿™ä¸ªå‘½åç©ºé—´æ˜¯ exampleã€‚

æ­¤å¤–ï¼Œç¤ºä¾‹åº”ç”¨æ¶‰åŠåˆ°çš„èµ„æºæ¯”è¾ƒå¤šï¼Œä¸ºäº†æ›´æ¸…æ¥šåœ°æ¢³ç†å®ƒä»¬ä¹‹é—´çš„é€»è¾‘å…³ç³»ï¼Œæˆ‘ç»™ä½ ç®€å•åœ°æ€»ç»“ä¸€ä¸‹ã€‚

é¦–å…ˆï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl get all æ¥æŸ¥çœ‹æŸä¸ªå‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰èµ„æºï¼š

```powershell
â¯ kubectl get all -n example
NAMEÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  READYÂ  Â STATUSÂ  Â  RESTARTSÂ  Â AGE
pod/backend-648ff85f48-8qgjgÂ  Â  1/1Â  Â  Â RunningÂ  Â 0Â  Â  Â  Â  Â  29s
pod/backend-648ff85f48-f845hÂ  Â  1/1Â  Â  Â RunningÂ  Â 0Â  Â  Â  Â  Â  51s
pod/frontend-7b55cc5c67-4svjzÂ  Â 1/1Â  Â  Â RunningÂ  Â 0Â  Â  Â  Â  Â  14s
pod/frontend-7b55cc5c67-9cx57Â  Â 1/1Â  Â  Â RunningÂ  Â 0Â  Â  Â  Â  Â  14s
pod/postgres-7745b57d5d-f4trtÂ  Â 1/1Â  Â  Â RunningÂ  Â 0Â  Â  Â  Â  Â  44m

NAMEÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â TYPEÂ  Â  Â  Â  CLUSTER-IPÂ  Â  Â  EXTERNAL-IPÂ  Â PORT(S)Â  Â  AGE
service/backend-serviceÂ  Â  ClusterIPÂ  Â 10.96.244.140Â  Â <none>Â  Â  Â  Â  5000/TCPÂ  Â 42m
service/frontend-serviceÂ  Â ClusterIPÂ  Â 10.96.85.54Â  Â  Â <none>Â  Â  Â  Â  3000/TCPÂ  Â 43m
service/pg-serviceÂ  Â  Â  Â  Â ClusterIPÂ  Â 10.96.166.74Â  Â  <none>Â  Â  Â  Â  5432/TCPÂ  Â 44m

NAMEÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â READYÂ  Â UP-TO-DATEÂ  Â AVAILABLEÂ  Â AGE
deployment.apps/backendÂ  Â  2/2Â  Â  Â 2Â  Â  Â  Â  Â  Â  2Â  Â  Â  Â  Â  Â 42m
deployment.apps/frontendÂ  Â 2/2Â  Â  Â 4Â  Â  Â  Â  Â  Â  4Â  Â  Â  Â  Â  Â 43m
deployment.apps/postgresÂ  Â 1/1Â  Â  Â 1Â  Â  Â  Â  Â  Â  1Â  Â  Â  Â  Â  Â 44m

NAMEÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  DESIREDÂ  Â CURRENTÂ  Â READYÂ  Â AGE
replicaset.apps/backend-648ff85f48Â  Â  2Â  Â  Â  Â  Â 2Â  Â  Â  Â  Â 2Â  Â  Â  Â 51s
replicaset.apps/frontend-7b55cc5c67Â  Â 2Â  Â  Â  Â  Â 2Â  Â  Â  Â  Â 2Â  Â  Â  Â 54s
replicaset.apps/postgres-7745b57d5dÂ  Â 1Â  Â  Â  Â  Â 1Â  Â  Â  Â  Â 1Â  Â  Â  Â 44m

NAMEÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â REFERENCEÂ  Â  Â  Â  Â  Â  Â TARGETSÂ  Â  MINPODSÂ  Â MAXPODSÂ  Â REPLICASÂ  Â AGE
horizontalpodautoscaler.autoscaling/backendÂ  Â  Deployment/backendÂ  Â  0%/50%Â  Â  Â 2Â  Â  Â  Â  Â 10Â  Â  Â  Â  2Â  Â  Â  Â  Â  8m17s
horizontalpodautoscaler.autoscaling/frontendÂ  Â Deployment/frontendÂ  Â 51%/80%Â  Â 2Â  Â  Â  Â  Â 10Â  Â  Â  Â  10Â  Â  Â  Â  Â 8m17s

```

-n å‚æ•°è¡¨ç¤ºæŒ‡å®šä¸€ä¸ªå‘½åç©ºé—´ï¼Œä»è¿”å›ç»“æœå¯ä»¥çœ‹å‡ºï¼Œç¤ºä¾‹åº”ç”¨ä¸€å…±åˆ›å»ºäº† 5 ä¸ª Podã€3 ä¸ª Serviceã€3 ä¸ª Deploymentã€3 ä¸ª Replicasetã€2 ä¸ª HPAï¼Œæ˜¯ä¸æ˜¯å¯¹æœ‰äº›æ¦‚å¿µæœ‰ç‚¹é™Œç”Ÿå‘¢ï¼Ÿåˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬è¿˜ä¼šåœ¨æ¥ä¸‹æ¥çš„è¯¾ç¨‹ä¸­è¯¦ç»†ä»‹ç»ã€‚

## æ€»ç»“

åœ¨è¿™èŠ‚è¯¾ï¼Œæˆ‘ä¸ºä½ å‡†å¤‡äº†ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ï¼Œå¹¶å¼•å¯¼ä½ åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æœ¬åœ° Kind é›†ç¾¤ï¼Œè¿˜å®Œæˆäº†éƒ¨ç½²çš„æ“ä½œã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ä»‹ç»äº†åº”ç”¨æ•´ä½“çš„æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ä¸šåŠ¡æ¶æ„å’Œ K8s éƒ¨ç½²æ¶æ„ã€‚

ç¤ºä¾‹åº”ç”¨ä¸»è¦ä»çœŸå®é¡¹ç›®å‡ºå‘ï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªåº”ç”¨é‡Œå‡ºç°çš„å¤§å¤šæ•° K8s å¯¹è±¡ï¼Œä½ ä¹Ÿä¼šåœ¨å®é™…å·¥ä½œä¸­ç”¨åˆ°å®ƒä»¬ï¼ŒæŒæ¡å®ƒä»¬æœ‰åŠ©äºä½ æŠŠçœŸå®çš„åº”ç”¨è¿ç§»åˆ° K8sã€‚åœ¨æ¥ä¸‹æ¥çš„è¯¾ç¨‹é‡Œï¼Œæˆ‘ä¼šä»è¿™ä¸ªç¤ºä¾‹åº”ç”¨å‡ºå‘ï¼Œä¸ºä½ è¯¦ç»†ä»‹ç»è¿™é‡Œå‡ºç°çš„æ¯ä¸€ä¸ª K8s å¯¹è±¡ç±»å‹ï¼Œä¸ºæœªæ¥çš„ GitOps è¯¾ç¨‹æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚

## æ€è€ƒé¢˜

æœ€åï¼Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜å§ã€‚

è¯·ä½ å°è¯•åœ¨ç¤ºä¾‹åº”ç”¨ä¸­æ·»åŠ ä¸€äº›æ•°æ®ï¼Œç„¶åä½¿ç”¨ kubectl delete pod åˆ é™¤ Postgres çš„ Podï¼Œåˆ é™¤å K8s å°†ä¼šé‡æ–°åˆ›å»º Podï¼Œè¯·ä½ è§‚å¯Ÿä¸€ä¸‹ä¹‹å‰ä¿å­˜çš„æ•°æ®è¿˜å­˜åœ¨å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ

æ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€äº¤æµè®¨è®ºï¼Œä½ ä¹Ÿå¯ä»¥æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚